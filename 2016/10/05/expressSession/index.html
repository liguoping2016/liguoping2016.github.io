<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>expressSession | 前端小博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="express-session一、什么是session？最近在学习node.js 的express框架，接触到了关于session方面的内容。翻阅了一些的博客，学到了不少东西，发现一篇博文讲的很好，概念内容摘抄如下：
Session是什么
Session一般译作会话，牛津词典对其的解释是进行某活动连续的一段时间。从不同的层面看待session，它有着类似但不全然相同的含义。比如，在web应用的用户">
<meta property="og:type" content="article">
<meta property="og:title" content="expressSession">
<meta property="og:url" content="http://yoursite.com/2016/10/05/expressSession/index.html">
<meta property="og:site_name" content="前端小博客">
<meta property="og:description" content="express-session一、什么是session？最近在学习node.js 的express框架，接触到了关于session方面的内容。翻阅了一些的博客，学到了不少东西，发现一篇博文讲的很好，概念内容摘抄如下：
Session是什么
Session一般译作会话，牛津词典对其的解释是进行某活动连续的一段时间。从不同的层面看待session，它有着类似但不全然相同的含义。比如，在web应用的用户">
<meta property="og:image" content="https://img.shields.io/github/stars/aerospike/aerospike-session-store-expressjs.svg?label=%E2%98%85****">
<meta property="og:image" content="https://img.shields.io/github/stars/webcc/cassandra-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/coolaj86/cluster-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/mike-goodwin/connect-azuretables.svg?label=%E2%98%85****">
<meta property="og:image" content="https://img.shields.io/github/stars/christophermina/connect-couchbase.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/adriantanasa/connect-datacache.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/wallali/connect-db2.svg?label=%E2%98%85****">
<meta property="og:image" content="https://img.shields.io/github/stars/ca98am79/connect-dynamodb.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/Requarks/connect-loki.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/bluetorch/connect-ml.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/patriksimek/connect-mssql.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/MonetDB/npm-connect-monetdb.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/kcbanner/connect-mongo.svg?label=%E2%98%85">
<meta property="og:image" content="https://www.npmjs.com/package/connect-mongodb-session">
<meta property="og:image" content="https://img.shields.io/github/stars/tj/connect-redis.svg?label=%E2%98%85">
<meta property="og:image" content="https://www.npmjs.com/package/connect-redis">
<meta property="og:image" content="https://img.shields.io/github/stars/balor/connect-memcached.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/llambda/connect-session-knex.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/mweibel/connect-session-sequelize.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/chill117/express-mysql-session.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/tgohn/express-session-level.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/rawberg/connect-sqlite3.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/dwhieb/documentdb-session.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/louischatriot/express-nedb-session.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/tgohn/express-session-level.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/gildean/express-etcd.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/jackspaniel/hazelcast-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/scriptollc/level-session-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/BenjaminVadant/medea-session-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/jwathen/mssql-session-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/JamesMGreene/nedb-session-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/MattMcFarland/sequelstore-connect.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/valery-barysok/session-file-store.svg?label=%E2%98%85">
<meta property="og:image" content="https://img.shields.io/github/stars/llambda/session-rethinkdb.svg?label=%E2%98%85">
<meta property="og:updated_time" content="2016-11-19T03:52:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="expressSession">
<meta name="twitter:description" content="express-session一、什么是session？最近在学习node.js 的express框架，接触到了关于session方面的内容。翻阅了一些的博客，学到了不少东西，发现一篇博文讲的很好，概念内容摘抄如下：
Session是什么
Session一般译作会话，牛津词典对其的解释是进行某活动连续的一段时间。从不同的层面看待session，它有着类似但不全然相同的含义。比如，在web应用的用户">
<meta name="twitter:image" content="https://img.shields.io/github/stars/aerospike/aerospike-session-store-expressjs.svg?label=%E2%98%85****">
  
    <link rel="alternative" href="/atom.xml" title="前端小博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/main.css">
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img5.imgtn.bdimg.com/it/u=1999300046,1517656119&amp;fm=21&amp;gp=0.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">lgp</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
		        
					<a class="rss" target="_blank" href="#" title="rss">rss</a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">lgp</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img5.imgtn.bdimg.com/it/u=1999300046,1517656119&amp;fm=21&amp;gp=0.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">lgp</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-expressSession" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      expressSession
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="express-session"><a href="#express-session" class="headerlink" title="express-session"></a>express-session</h1><h2 id="一、什么是session？"><a href="#一、什么是session？" class="headerlink" title="一、什么是session？"></a>一、什么是session？</h2><p>最近在学习node.js 的express框架，接触到了关于session方面的内容。翻阅了一些的博客，学到了不少东西，发现一篇博文讲的很好，概念内容摘抄如下：</p>
<p><code>Session是什么</code></p>
<pre><code>Session一般译作会话，牛津词典对其的解释是进行某活动连续的一段时间。从不同的层面看待session，它有着类似但不全然相同的含义。比如，在web应用的用户看来，他打开浏览器访问一个电子商务网站，登录、并完成购物直到关闭浏览器，这是一个会话。而在web应用的开发者开来，用户登录时我需要创建一个数据结构以存储用户的登录信息，这个结构也叫做session。因此在谈论session的时候要注意上下文环境。而本文谈论的是一种基于HTTP协议的用以增强web应用能力的机制或者说一种方案，它不是单指某种特定的动态页面技术，而这种能力就是保持状态，也可以称作保持会话。
</code></pre><p><code>为什么需要session</code></p>
<pre><code>谈及session一般是在web应用的背景之下，我们知道web应用是基于HTTP协议的，而HTTP协议恰恰是一种无状态协议。也就是说，用户从A页面跳转到B页面会重新发送一次HTTP请求，而服务端在返回响应的时候是无法获知该用户在请求B页面之前做了什么的。

对于HTTP的无状态性的原因，相关RFC里并没有解释，但联系到HTTP的历史以及应用场景，我们可以推测出一些理由：

1.   设计HTTP最初的目的是为了提供一种发布和接收HTML页面的方法。那个时候没有动态页面技术，只有纯粹的静态HTML页面，因此根本不需要协议能保持状态；
2.   用户在收到响应时，往往要花一些时间来阅读页面，因此如果保持客户端和服务端之间的连接，那么这个连接在大多数的时间里都将是空闲的，这是一种资源的无端浪费。所以HTTP原始的设计是默认短连接，即客户端和服务端完成一次请求和响应之后就断开TCP连接，服务器因此无法预知客户端的下一个动作，它甚至都不知道这个用户会不会再次访问，因此让HTTP协议来维护用户的访问状态也全然没有必要；
3.   将一部分复杂性转嫁到以HTTP协议为基础的技术之上可以使得HTTP在协议这个层面上显得相对简单，而这种简单也赋予了HTTP更强的扩展能力。事实上，session技术从本质上来讲也是对HTTP协议的一种扩展。
总而言之，HTTP的无状态是由其历史使命而决定的。但随着网络技术的蓬勃发展，人们再也不满足于死板乏味的静态HTML，他们希望web应用能动起来，于是客户端出现了脚本和DOM技术，HTML里增加了表单，而服务端出现了CGI等等动态技术。

而正是这种web动态化的需求，给HTTP协议提出了一个难题：一个无状态的协议怎样才能关联两次连续的请求呢？也就是说无状态的协议怎样才能满足有状态的需求呢？

此时有状态是必然趋势而协议的无状态性也是木已成舟，因此我们需要一些方案来解决这个矛盾，来保持HTTP连接状态，于是出现了cookie和session。
</code></pre><p><code>对于此部分内容，读者或许会有一些疑问，笔者在此先谈两点：</code></p>
<pre><code>1.   无状态性和长连接
可能有人会问，现在被广泛使用的HTTP1.1默认使用长连接，它还是无状态的吗？
连接方式和有无状态是完全没有关系的两回事。因为状态从某种意义上来讲就是数据，而连接方式只是决定了数据的传输方式，而不能决定数据。长连接是随着计算机性能的提高和网络环境的改善所采取的一种合理的性能上的优化，一般情况下，web服务器会对长连接的数量进行限制，以免资源的过度消耗。
2.   无状态性和session
    Session是有状态的，而HTTP协议是无状态的，二者是否矛盾呢？

Session和HTTP协议属于不同层面的事物，后者属于ISO七层模型的最高层应用层，前者不属于后者，前者是具体的动态页面技术来实现的，但同时它又是基于后者的。在下文中笔者会分析Servlet/Jsp技术中的session机制，这会使你对此有更深刻的理解。
</code></pre><p><code>Cookie和Session</code></p>
<pre><code>上面提到解决HTTP协议自身无状态的方式有cookie和session。二者都能记录状态，前者是将状态数据保存在客户端，后者则保存在服务端。

首先看一下cookie的工作原理，这需要有基本的HTTP协议基础。

cookie是在RFC2109（已废弃，被RFC2965取代）里初次被描述的，每个客户端最多保持三百个cookie，每个域名下最多20个Cookie（实际上一般浏览器现在都比这个多，如Firefox是50个），而每个cookie的大小为最多4K，不过不同的浏览器都有各自的实现。对于cookie的使用，最重要的就是要控制cookie的大小，不要放入无用的信息，也不要放入过多信息。

无论使用何种服务端技术，只要发送回的HTTP响应中包含如下形式的头，则视为服务器要求设置一个cookie：
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Set-cookie:name=name;expires=date;path=path;domain=domain</div></pre></td></tr></table></figure>
<pre><code>支持cookie的浏览器都会对此作出反应，即创建cookie文件并保存（也可能是内存cookie），用户以后在每次发出请求时，浏览器都要判断当前所有的cookie中有没有没失效（根据expires属性判断）并且匹配了path属性的cookie信息，如果有的话，会以下面的形式加入到请求头中发回服务端：
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Cookie: name=&quot;zj&quot;; Path=&quot;/linkage&quot;</div></pre></td></tr></table></figure>
<pre><code>服务端的动态脚本会对其进行分析，并做出相应的处理，当然也可以选择直接忽略。

这里牵扯到一个规范（或协议）与实现的问题，简单来讲就是规范规定了做成什么样子，那么实现就必须依据规范来做，这样才能互相兼容，但是各个实现所使用的方式却不受约束，也可以在实现了规范的基础上超出规范，这就称之为扩展了。无论哪种浏览器，只要想提供cookie的功能，那就必须依照相应的RFC规范来实现。所以这里服务器只管发Set-cookie头域，这也是HTTP协议无状态性的一种体现。

需要注意的是，出于安全性的考虑，cookie可以被浏览器禁用。
</code></pre><p><code>再看一下session的原理：</code></p>
<pre><code>笔者没有找到相关的RFC，因为session本就不是协议层面的事物。它的基本原理是服务端为每一个session维护一份会话信息数据，而客户端和服务端依靠一个全局唯一的标识来访问会话信息数据。用户访问web应用时，服务端程序决定何时创建session，创建session可以概括为三个步骤：

1.   生成全局唯一标识符（sessionid）；
2.   开辟数据存储空间。一般会在内存中创建相应的数据结构，但这种情况下，系统一旦掉电，所有的会话数据就会丢失，如果是电子商务网站，这种事故会造成严重的后果。不过也可以写到文件里甚至存储在数据库中，这样虽然会增加I/O开销，但session可以实现某种程度的持久化，而且更有利于session的共享；
3.   将session的全局唯一标示符发送给客户端。
问题的关键就在服务端如何发送这个session的唯一标识上。联系到HTTP协议，数据无非可以放到请求行、头域或Body里，基于此，一般来说会有两种常用的方式：cookie和URL重写。
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1.   Cookie</div><div class="line">读者应该想到了，对，服务端只要设置Set-cookie头就可以将session的标识符传送到客户端，而客户端此后的每一次请求都会带上这个标识符，由于cookie可以设置失效时间，所以一般包含session信息的cookie会设置失效时间为0，即浏览器进程有效时间。至于浏览器怎么处理这个0，每个浏览器都有自己的方案，但差别都不会太大（一般体现在新建浏览器窗口的时候）；</div><div class="line">2.   URL重写</div><div class="line">所谓URL重写，顾名思义就是重写URL。试想，在返回用户请求的页面之前，将页面内所有的URL后面全部以get参数的方式加上session标识符（或者加在path info部分等等），这样用户在收到响应之后，无论点击哪个链接或提交表单，都会在再带上session的标识符，从而就实现了会话的保持。读者可能会觉得这种做法比较麻烦，确实是这样，但是，如果客户端禁用了cookie的话，URL重写将会是首选。</div><div class="line">    到这里，读者应该明白我前面为什么说session也算作是对HTTP的一种扩展了吧。如下两幅图是笔者在Firefox的Firebug插件中的截图，可以看到，当我第一次访问index.jsp时，响应头里包含了Set-cookie头，而请求头中没有。当我再次刷新页面时，图二显示在响应中不在有Set-cookie头，而在请求头中却有了Cookie头。注意一下Cookie的名字：jsessionid，顾名思义，就是session的标识符，另外可以看到两幅图中的jsessionid的值是相同的，原因笔者就不再多解释了。另外读者可能在一些网站上见过在最后附加了一段形如jsessionid=xxx的URL，这就是采用URL重写来实现的session。</div></pre></td></tr></table></figure>
<p><code>Cookie和session由于实现手段不同，因此也各有优缺点和各自的应用场景：</code></p>
<pre><code>1.   应用场景
Cookie的典型应用场景是Remember Me服务，即用户的账户信息通过cookie的形式保存在客户端，当用户再次请求匹配的URL的时候，账户信息会被传送到服务端，交由相应的程序完成自动登录等功能。当然也可以保存一些客户端信息，比如页面布局以及搜索历史等等。
Session的典型应用场景是用户登录某网站之后，将其登录信息放入session，在以后的每次请求中查询相应的登录信息以确保该用户合法。当然还是有购物车等等经典场景；
2.   安全性
cookie将信息保存在客户端，如果不进行加密的话，无疑会暴露一些隐私信息，安全性很差，一般情况下敏感信息是经过加密后存储在cookie中，但很容易就会被窃取。而session只会将信息存储在服务端，如果存储在文件或数据库中，也有被窃取的可能，只是可能性比cookie小了太多。
Session安全性方面比较突出的是存在会话劫持的问题，这是一种安全威胁，这在下文会进行更详细的说明。总体来讲，session的安全性要高于cookie；
3.   性能
Cookie存储在客户端，消耗的是客户端的I/O和内存，而session存储在服务端，消耗的是服务端的资源。但是session对服务器造成的压力比较集中，而cookie很好地分散了资源消耗，就这点来说，cookie是要优于session的；
4.   时效性
Cookie可以通过设置有效期使其较长时间内存在于客户端，而session一般只有比较短的有效期（用户主动销毁session或关闭浏览器后引发超时）；
5.   其他
Cookie的处理在开发中没有session方便。而且cookie在客户端是有数量和大小的限制的，而session的大小却只以硬件为限制，能存储的数据无疑大了太多。
</code></pre><h2 id="二、-express-session的安装"><a href="#二、-express-session的安装" class="headerlink" title="二、 express-session的安装"></a>二、 express-session的安装</h2><h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><pre><code>$ npm install express-session
</code></pre><h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><pre><code>var session = require(&apos;express-session&apos;)
</code></pre><h5 id="session-options"><a href="#session-options" class="headerlink" title="session(options)"></a>session(options)</h5><p>Create a session middleware with the given options.</p>
<p><code>Note</code> Session data is not saved in the cookie itself, just the session ID. Session data is stored server-side.</p>
<p><code>Note</code> Since version 1.5.0, the <a href="">cookie-parser middleware </a>no longer needs to be used for this module to work. This module now directly reads and writes cookies on req/res. Using cookie-parser may result in issues if the secret is not the same between this module and cookie-parser.</p>
<p><code>Warning</code> The default server-side session storage, MemoryStore, is purposely not designed for a production environment. It will leak memory under most conditions, does not scale past a single process, and is meant for debugging and developing.</p>
<p>For a list of stores, see <a href="">compatible session stores</a>.</p>
<h5 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h5><p>express-session accepts these properties in the options object.</p>
<h5 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h5><p>Settings object for the session ID cookie. The default value is <code>{ path: &#39;/&#39;, httpOnly: true, secure: false, maxAge: null }.</code></p>
<p>The following are options that can be set in this object.</p>
<h5 id="cookie-domain"><a href="#cookie-domain" class="headerlink" title="cookie.domain"></a>cookie.domain</h5><p>Specifies the value for the <code>Domain Set-Cookie</code> attribute. By default, no domain is set, and most clients will consider the cookie to apply to only the current domain.</p>
<h5 id="cookie-expires"><a href="#cookie-expires" class="headerlink" title="cookie.expires"></a>cookie.expires</h5><p>Specifies the <code>Date</code> object to be the value for the <code>Expires Set-Cookie</code> attribute. By default, no expiration is set, and most clients will consider this a “non-persistent cookie” and will delete it on a condition like exiting a web browser application.</p>
<p><code>Note</code> If both <code>expires</code> and <code>maxAge</code> are set in the options, then the last one defined in the object is what is used.</p>
<p><code>Note</code> The <code>expires</code> option should not be set directly;<br>instead only use the maxAge option.</p>
<p>cookie.httpOnly<br>Specifies the <code>boolean</code> value for the <code>HttpOnly Set-Cookie</code> attribute. When truthy, the HttpOnly attribute is set, otherwise it is not. By default, the <code>HttpOnly</code> attribute is set.</p>
<p><code>Note</code> be careful when setting this to <code>true</code>, as compliant clients will not allow client-side JavaScript to see the cookie in <code>document.cookie</code>.</p>
<h5 id="cookie-maxAge"><a href="#cookie-maxAge" class="headerlink" title="cookie.maxAge"></a>cookie.maxAge</h5><p>Specifies the number (in milliseconds) to use when calculating the <code>Expires Set-Cookie</code> attribute. This is done by taking the current server time and adding maxAge milliseconds to the value to calculate an <code>Expires</code> datetime. By default, no maximum age is set.</p>
<p><code>Note</code> If both <code>expires</code> and <code>maxAge</code> are set in the options, then the last one defined in the object is what is used.</p>
<h5 id="cookie-path"><a href="#cookie-path" class="headerlink" title="cookie.path"></a>cookie.path</h5><p>Specifies the value for the <code>Path Set-Cookie</code>. By default, this is set to ‘/‘, which is the root path of the domain.</p>
<h5 id="cookie-sameSite"><a href="#cookie-sameSite" class="headerlink" title="cookie.sameSite"></a>cookie.sameSite</h5><p>Specifies the boolean or string to be the value for the SameSite Set-Cookie attribute.</p>
<ul>
<li>true will set the SameSite attribute to Strict for strict same site enforcement.</li>
<li>false will not set the SameSite attribute.</li>
<li>‘lax’ will set the SameSite attribute to Lax for lax same site enforcement.</li>
<li>‘strict’ will set the SameSite attribute to Strict for strict same site enforcement.<br>More information about the different enforcement levels can be found in the specification <a href="https://tools.ietf.org/html/draft-west-first-party-cookies-07#section-4.1.1" target="_blank" rel="external">https://tools.ietf.org/html/draft-west-first-party-cookies-07#section-4.1.1</a></li>
</ul>
<p><code>Note</code>This is an attribute that has not yet been fully standardized, and may change in the future. This also means many clients may ignore this attribute until they understand it.</p>
<h5 id="cookie-secure"><a href="#cookie-secure" class="headerlink" title="cookie.secure"></a>cookie.secure</h5><p>Specifies the boolean value for the <code>Secure Set-Cookie</code>attribute. When truthy, the Secure attribute is set, otherwise it is not. By default, the Secure attribute is not set.</p>
<p>Note be careful when setting this to true, as compliant clients will not send the cookie back to the server in the future if the browser does not have an HTTPS connection.</p>
<p>Please note that secure: true is a <a href="">recommended</a> option. However, it requires an https-enabled website, i.e., HTTPS is necessary for secure cookies. If secure is set, and you access your site over HTTP, the cookie will not be set. If you have your node.js behind a proxy and are using secure: true, you need to set “trust proxy” in express:</p>
<pre><code>var app = express()
app.set(&apos;trust proxy&apos;, 1) // trust first proxy 
app.use(session({
     secret: &apos;keyboard cat&apos;,
      resave: false,
      saveUninitialized: true,
      cookie: { secure: true }
  }))
</code></pre><p>For using secure cookies in production, but allowing for testing in development, the following is an example of enabling this setup based on NODE_ENV in express:</p>
<pre><code>var app = express()
var sess = {
      secret: &apos;keyboard cat&apos;,
      cookie: {}
}

if (app.get(&apos;env&apos;) === &apos;production&apos;) {
      app.set(&apos;trust proxy&apos;, 1) // trust first proxy 
      sess.cookie.secure = true // serve secure cookies 
}
</code></pre><p>app.use(session(sess))<br>The <code>cookie.secure</code> option can also be set to the special value <code>&#39;auto&#39;</code> to have this setting automatically match the determined security of the connection. Be careful when using this setting if the site is available both as HTTP and HTTPS, as once the cookie is set on HTTPS, it will no longer be visible over HTTP. This is useful when the Express <code>&quot;trust proxy&quot;</code> setting is properly setup to simplify development vs production configuration.</p>
<h5 id="genid"><a href="#genid" class="headerlink" title="genid"></a>genid</h5><p>Function to call to generate a new session ID. Provide a function that returns a string that will be used as a session ID. The function is given req as the first argument if you want to use some value attached to req when generating the ID.</p>
<p>The default value is a function which uses the uid-safe library to generate IDs.</p>
<p><code>NOTE</code> be careful to generate unique IDs so your sessions do not conflict.</p>
<pre><code>app.use(session({
  genid: function(req) {
    return genuuid() // use UUIDs for session IDs 
  },
  secret: &apos;keyboard cat&apos;
}))
</code></pre><h5 id="name"><a href="#name" class="headerlink" title="name"></a>name</h5><p>The name of the session ID cookie to set in the response (and read from in the request).</p>
<p>The default value is <code>&#39;connect.sid&#39;</code>.</p>
<p><code>Note</code> if you have multiple apps running on the same hostname (this is just the name, i.e. <code>localhost or 127.0.0.1;</code> different schemes and ports do not name a different hostname), then you need to separate the session cookies from each other. The simplest method is to simply set different names per app.</p>
<h5 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h5><p>Trust the reverse proxy when setting secure cookies (via the “X-Forwarded-Proto” header).</p>
<p>The default value is <code>undefined</code>.</p>
<ul>
<li>true The “X-Forwarded-Proto” header will be used.</li>
<li>false All headers are ignored and the connection is considered secure only if there is a direct TLS/SSL connection.</li>
<li>undefined Uses the “trust proxy” setting from express</li>
</ul>
<h5 id="resave"><a href="#resave" class="headerlink" title="resave"></a>resave</h5><p>Forces the session to be saved back to the session store, even if the session was never modified during the request. Depending on your store this may be necessary, but it can also create race conditions where a client makes two parallel requests to your server and changes made to the session in one request may get overwritten when the other request ends, even if it made no changes (this behavior also depends on what store you’re using).</p>
<p>The default value is <code>true</code>, but using the default has been deprecated, as the default will change in the future. Please research into this setting and choose what is appropriate to your use-case. Typically, you’ll want <code>false</code>.</p>
<p>How do I know if this is necessary for my store? The best way to know is to check with your store if it implements the touch method. If it does, then you can safely set <code>resave: false</code>. If it does not implement the <code>touch</code> method and your store sets an expiration date on stored sessions, then you likely need <code>resave: true</code>.</p>
<h5 id="rolling"><a href="#rolling" class="headerlink" title="rolling"></a>rolling</h5><p>Force a session identifier cookie to be set on every response. The expiration is reset to the original <a href="">maxAge</a>, resetting the expiration countdown.</p>
<p>The default value is false.</p>
<p><code>Note</code> When this option is set to true but the saveUninitialized option is set to false, the cookie will not be set on a response with an uninitialized session.</p>
<h5 id="saveUninitialized"><a href="#saveUninitialized" class="headerlink" title="saveUninitialized"></a>saveUninitialized</h5><p>Forces a session that is “uninitialized” to be saved to the store. A session is uninitialized when it is new but not modified. Choosing <code>false</code> is useful for implementing login sessions, reducing server storage usage, or complying with laws that require permission before setting a cookie. Choosing <code>false</code> will also help with race conditions where a client makes multiple parallel requests without a session.</p>
<p>The default value is true, but using the default has been deprecated, as the default will change in the future. Please research into this setting and choose what is appropriate to your use-case.</p>
<p><code>Note</code> if you are using Session in conjunction with PassportJS, Passport will add an empty Passport object to the session for use after a user is authenticated, which will be treated as a modification to the session, causing it to be saved. This has been fixed in PassportJS 0.3.0</p>
<h5 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h5><h5 id="Required-option"><a href="#Required-option" class="headerlink" title="Required option"></a>Required option</h5><p>This is the secret used to sign the session ID cookie. This can be either a string for a single secret, or an array of multiple secrets. If an array of secrets is provided, only the first element will be used to sign the session ID cookie, while all the elements will be considered when verifying the signature in requests.</p>
<h5 id="store"><a href="#store" class="headerlink" title="store"></a>store</h5><p>The session store instance, defaults to a new <code>MemoryStore</code> instance.</p>
<h5 id="unset"><a href="#unset" class="headerlink" title="unset"></a>unset</h5><p>Control the result of unsetting req.session (through delete, setting to null, etc.).</p>
<p>The default value is <code>&#39;keep&#39;</code>.</p>
<ul>
<li><code>&#39;destroy&#39;</code> The session will be destroyed (deleted) when the response ends.</li>
<li><code>&#39;keep&#39;</code> The session in the store will be kept, but modifications made during the request are ignored and not saved.</li>
</ul>
<h5 id="req-session"><a href="#req-session" class="headerlink" title="req.session"></a>req.session</h5><p>To store or access session data, simply use the request property <code>req.session</code>, which is (generally) serialized as JSON by the store, so nested objects are typically fine. For example below is a user-specific view counter:</p>
<pre><code>// Use the session middleware 
app.use(session({ secret: &apos;keyboard cat&apos;, cookie:     { maxAge: 60000 }}))

// Access the session as req.session 
app.get(&apos;/&apos;, function(req, res, next) {
     var sess = req.session
      if (sess.views) {
    sess.views++
    res.setHeader(&apos;Content-Type&apos;, &apos;text/html&apos;)
    res.write(&apos;&lt;p&gt;views: &apos; + sess.views + &apos;&lt;/p&gt;&apos;)
    res.write(&apos;&lt;p&gt;expires in: &apos; +     (sess.cookie.maxAge / 1000) + &apos;s&lt;/p&gt;&apos;)
        res.end()
      } else {
        sess.views = 1
    res.end(&apos;welcome to the session demo. refresh!&apos;)
      }
})
</code></pre><h5 id="Session-regenerate-callback"><a href="#Session-regenerate-callback" class="headerlink" title="Session.regenerate(callback)"></a>Session.regenerate(callback)</h5><p>To regenerate the session simply invoke the method. Once complete, a new SID and Session instance will be initialized at req.session and the callback will be invoked.</p>
<pre><code>req.session.regenerate(function(err) {
      // will have a new session here 
})
</code></pre><h5 id="Session-destroy-callback"><a href="#Session-destroy-callback" class="headerlink" title="Session.destroy(callback)"></a>Session.destroy(callback)</h5><p>Destroys the session and will unset the req.session property. Once complete, the callback will be invoked.</p>
<pre><code>req.session.destroy(function(err) {
      // cannot access session here 
})
</code></pre><h5 id="Session-reload-callback"><a href="#Session-reload-callback" class="headerlink" title="Session.reload(callback)"></a>Session.reload(callback)</h5><p>Reloads the session data from the store and re-populates the <code>req.session</code> object. Once complete, the callback will be invoked.</p>
<pre><code>req.session.reload(function(err) {
      // session updated 
})
</code></pre><h5 id="Session-save-callback"><a href="#Session-save-callback" class="headerlink" title="Session.save(callback)"></a>Session.save(callback)</h5><p>Save the session back to the store, replacing the contents on the store with the contents in memory (though a store may do something else–consult the store’s documentation for exact behavior).</p>
<p>This method is automatically called at the end of the HTTP response if the session data has been altered (though this behavior can be altered with various options in the middleware constructor). Because of this, typically this method does not need to be called.</p>
<p>There are some cases where it is useful to call this method, for example, long- lived requests or in WebSockets.</p>
<pre><code>req.session.save(function(err) {
      // session saved 
})
</code></pre><h5 id="Session-touch"><a href="#Session-touch" class="headerlink" title="Session.touch()"></a>Session.touch()</h5><p>Updates the <code>.maxAge</code> property. Typically this is not necessary to call, as the session middleware does this for you.</p>
<h5 id="req-session-id"><a href="#req-session-id" class="headerlink" title="req.session.id"></a>req.session.id</h5><p>Each session has a unique ID associated with it. This property will contain the session ID and cannot be modified.</p>
<h5 id="req-session-cookie"><a href="#req-session-cookie" class="headerlink" title="req.session.cookie"></a>req.session.cookie</h5><p>Each session has a unique cookie object accompany it. This allows you to alter the session cookie per visitor. For example we can set <code>req.session.cookie.expires</code> to false to enable the cookie to remain for only the duration of the user-agent.</p>
<h5 id="Cookie-maxAge"><a href="#Cookie-maxAge" class="headerlink" title="Cookie.maxAge"></a>Cookie.maxAge</h5><p>Alternatively <code>req.session.cookie.maxAge</code> will return the time remaining in milliseconds, which we may also re-assign a new value to adjust the .expires property appropriately. The following are essentially equivalent</p>
<pre><code>var hour = 3600000
req.session.cookie.expires = new Date(Date.now() + hour)
req.session.cookie.maxAge = hour
</code></pre><p>For example when maxAge is set to 60000 (one minute), and 30 seconds has elapsed it will return 30000 until the current request has completed, at which time req.session.touch() is called to reset req.session.maxAge to its original value.</p>
<pre><code>req.session.cookie.maxAge // =&gt; 30000 
</code></pre><h5 id="req-sessionID"><a href="#req-sessionID" class="headerlink" title="req.sessionID"></a>req.sessionID</h5><p>To get the ID of the loaded session, access the request property req.sessionID. This is simply a read-only value set when a session is loaded/created.</p>
<h5 id="Session-Store-Implementation"><a href="#Session-Store-Implementation" class="headerlink" title="Session Store Implementation"></a>Session Store Implementation</h5><p>Every session store must be an EventEmitter and implement specific methods. The following methods are the list of<br> <a href="">required</a>, <a href="">recommended</a>, <a href="">and optional</a>.</p>
<ul>
<li>Required methods are ones that this module will always call on the store.</li>
<li>Recommended methods are ones that this module will call on the store if available.</li>
<li>Optional methods are ones this module does not call at all, but helps present uniform stores to users.<br>For an example implementation view the <a href="https://github.com/tj/connect-redis" target="_blank" rel="external">connect-redis </a>repo.</li>
</ul>
<h5 id="store-all-callback"><a href="#store-all-callback" class="headerlink" title="store.all(callback)"></a>store.all(callback)</h5><h6 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h6><p>This optional method is used to get all sessions in the store as an array. The callback should be called as callback(error, sessions).</p>
<p>store.destroy(sid, callback)<br>Required</p>
<p>This required method is used to destroy/delete a session from the store given a session ID <code>(sid)</code>. The <code>callback</code> should be called as <code>callback(error)</code> once the session is destroyed.</p>
<h5 id="store-clear-callback"><a href="#store-clear-callback" class="headerlink" title="store.clear(callback)"></a>store.clear(callback)</h5><h6 id="Optional-1"><a href="#Optional-1" class="headerlink" title="Optional"></a>Optional</h6><p>This optional method is used to delete all sessions from the store. The <code>callback</code> should be called as <code>callback(error)</code> once the store is cleared.</p>
<h5 id="store-length-callback"><a href="#store-length-callback" class="headerlink" title="store.length(callback)"></a>store.length(callback)</h5><h6 id="Optional-2"><a href="#Optional-2" class="headerlink" title="Optional"></a>Optional</h6><p>This optional method is used to get the count of all sessions in the store. The <code>callback</code> should be called as <code>callback(error, len)</code>.</p>
<h5 id="store-get-sid-callback"><a href="#store-get-sid-callback" class="headerlink" title="store.get(sid, callback)"></a>store.get(sid, callback)</h5><h6 id="Required"><a href="#Required" class="headerlink" title="Required"></a>Required</h6><p>This required method is used to get a session from the store given a session ID <code>(sid)</code>. The <code>callback</code> should be called as <code>callback(error, session)</code>.</p>
<p>The <code>session</code> argument should be a session if found, otherwise null or undefined if the session was not found (and there was no error). A special case is made when <code>error.code === &#39;ENOENT&#39;</code> to act like <code>callback(null, null)</code>.</p>
<h5 id="store-set-sid-session-callback"><a href="#store-set-sid-session-callback" class="headerlink" title="store.set(sid, session, callback)"></a>store.set(sid, session, callback)</h5><h6 id="Required-1"><a href="#Required-1" class="headerlink" title="Required"></a>Required</h6><p>This required method is used to upsert a session into the store given a session ID (sid) and session (<code>session</code>) object. The callback should be called as <code>callback(error)</code> once the session has been set in the store.</p>
<h5 id="store-touch-sid-session-callback"><a href="#store-touch-sid-session-callback" class="headerlink" title="store.touch(sid, session, callback)"></a>store.touch(sid, session, callback)</h5><h6 id="Recommended"><a href="#Recommended" class="headerlink" title="Recommended"></a>Recommended</h6><p>This recommended method is used to “touch” a given session given a session ID (<code>sid</code>) and session (<code>session</code>) object. The callback should be called as <code>callback(error)</code> once the session has been touched.</p>
<p>This is primarily used when the store will automatically delete idle sessions and this method is used to signal to the store the given session is active, potentially resetting the idle timer.</p>
<h5 id="Compatible-Session-Stores"><a href="#Compatible-Session-Stores" class="headerlink" title="Compatible Session Stores"></a>Compatible Session Stores</h5><p>The following modules implement a session store that is compatible with this module. Please make a PR to add additional modules :)</p>
<p><img src="https://img.shields.io/github/stars/aerospike/aerospike-session-store-expressjs.svg?label=%E2%98%85****" alt=""> <a href="https://www.npmjs.com/package/aerospike-session-store" target="_blank" rel="external">aerospike-session-store</a> A session store using <a href="http://www.aerospike.com/" target="_blank" rel="external">Aerospike</a>.</p>
<p><img src="https://img.shields.io/github/stars/webcc/cassandra-store.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/cassandra-store" target="_blank" rel="external">cassandra-store</a> An Apache Cassandra-based session store.</p>
<p><img src="https://img.shields.io/github/stars/coolaj86/cluster-store.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/cluster-store" target="_blank" rel="external">cluster-store</a> A wrapper for using in-process / embedded stores - such as SQLite (via knex), leveldb, files, or memory - with node cluster (desirable for Raspberry Pi 2 and other multi-core embedded devices).</p>
<p><img src="https://img.shields.io/github/stars/mike-goodwin/connect-azuretables.svg?label=%E2%98%85****" alt=""><a href="https://www.npmjs.com/package/connect-azuretables" target="_blank" rel="external">connect-azuretables</a> An<a href="https://azure.microsoft.com/en-gb/services/storage/tables/" target="_blank" rel="external"> Azure Table Storage</a>-based session store.</p>
<p><img src="https://img.shields.io/github/stars/christophermina/connect-couchbase.svg?label=%E2%98%85" alt="">[connect-couchbase] (<a href="https://www.npmjs.com/package/connect-couchbase)A" target="_blank" rel="external">https://www.npmjs.com/package/connect-couchbase)A</a> <a href="http://www.couchbase.com/" target="_blank" rel="external">couchbase</a>-based session store.</p>
<p><img src="https://img.shields.io/github/stars/adriantanasa/connect-datacache.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-datacache" target="_blank" rel="external">connect-datacache</a> An <a href="https://www.ibm.com/cloud-computing/bluemix/" target="_blank" rel="external">IBM Bluemix Data Cache</a>-based session store.</p>
<p><img src="https://img.shields.io/github/stars/wallali/connect-db2.svg?label=%E2%98%85****" alt=""><a href="https://www.npmjs.com/package/connect-db2" target="_blank" rel="external">connect-db2</a> An IBM DB2-based session store built using <a href="https://www.npmjs.com/package/ibm_db" target="_blank" rel="external">ibm_db</a> module.</p>
<p><img src="https://img.shields.io/github/stars/ca98am79/connect-dynamodb.svg?label=%E2%98%85" alt=""><a href="https://github.com/ca98am79/connect-dynamodb" target="_blank" rel="external">connect-dynamodb</a> A DynamoDB-based session store.</p>
<p><img src="https://img.shields.io/github/stars/Requarks/connect-loki.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-loki" target="_blank" rel="external">connect-loki</a> A Loki.js-based session store.</p>
<p><img src="https://img.shields.io/github/stars/bluetorch/connect-ml.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-ml" target="_blank" rel="external">connect-ml</a> A MarkLogic Server-based session store.</p>
<p><img src="https://img.shields.io/github/stars/patriksimek/connect-mssql.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-mssql" target="_blank" rel="external">connect-mssql</a> A SQL Server-based session store.</p>
<p><img src="https://img.shields.io/github/stars/MonetDB/npm-connect-monetdb.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-monetdb" target="_blank" rel="external">connect-monetdb</a> A MonetDB-based session store.</p>
<p><img src="https://img.shields.io/github/stars/kcbanner/connect-mongo.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-mongo" target="_blank" rel="external">connect-mongo</a> A MongoDB-based session store.</p>
<p><img src="https://www.npmjs.com/package/connect-mongodb-session" alt=""><a href="https://www.npmjs.com/package/connect-mongodb-session" target="_blank" rel="external">connect-mongodb-session</a> Lightweight MongoDB-based session store built and maintained by MongoDB.</p>
<p><img src="https://img.shields.io/github/stars/tj/connect-redis.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-pg-simple" target="_blank" rel="external">connect-pg-simple</a> A PostgreSQL-based session store.</p>
<p><img src="https://www.npmjs.com/package/connect-redis" alt=""><a href="https://www.npmjs.com/package/connect-redis" target="_blank" rel="external">connect-redis</a> A Redis-based session store.</p>
<p><img src="https://img.shields.io/github/stars/balor/connect-memcached.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-memcached" target="_blank" rel="external">connect-memcached</a> A memcached-based session store.</p>
<p><img src="https://img.shields.io/github/stars/llambda/connect-session-knex.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-session-knex" target="_blank" rel="external">connect-session-knex</a> A session store using <a href="http://knexjs.org/" target="_blank" rel="external">Knex.js</a>, which is a SQL query builder for PostgreSQL, MySQL, MariaDB, SQLite3, and Oracle.</p>
<p><img src="https://img.shields.io/github/stars/mweibel/connect-session-sequelize.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-session-sequelize" target="_blank" rel="external">connect-session-sequelize</a> A session store using <a href="http://docs.sequelizejs.com/en/v3/" target="_blank" rel="external">Sequelize.js</a>, which is a Node.js / io.js ORM for PostgreSQL, MySQL, SQLite and MSSQL.</p>
<p><img src="https://img.shields.io/github/stars/chill117/express-mysql-session.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/express-mysql-session" target="_blank" rel="external">express-mysql-session</a> A session store using native <a href="https://www.mysql.com/" target="_blank" rel="external">MySQL</a> via the <a href="https://github.com/mysqljs/mysql" target="_blank" rel="external">node-mysql</a> module.</p>
<p><img src="https://img.shields.io/github/stars/tgohn/express-session-level.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/express-sessions" target="_blank" rel="external">express-sessions</a>: A session store supporting both MongoDB and Redis.</p>
<p><img src="https://img.shields.io/github/stars/rawberg/connect-sqlite3.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/connect-sqlite3" target="_blank" rel="external">connect-sqlite3</a> A <a href="https://github.com/mapbox/node-sqlite3" target="_blank" rel="external">SQLite3</a>session store modeled after the TJ’s connect-redis store.</p>
<p><img src="https://img.shields.io/github/stars/dwhieb/documentdb-session.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/documentdb-session" target="_blank" rel="external">documentdb-session</a>A session store for Microsoft Azure’s <a href="https://azure.microsoft.com/en-us/services/documentdb/" target="_blank" rel="external">DocumentDB</a> NoSQL database service.</p>
<p><img src="https://img.shields.io/github/stars/louischatriot/express-nedb-session.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/express-nedb-session" target="_blank" rel="external">express-nedb-session</a> A NeDB-based session store.</p>
<p><img src="https://img.shields.io/github/stars/tgohn/express-session-level.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/express-session-level" target="_blank" rel="external">express-session-level</a> A <a href="https://github.com/Level/levelup" target="_blank" rel="external">LevelDB</a> based session store.</p>
<p><img src="https://img.shields.io/github/stars/gildean/express-etcd.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/express-etcd" target="_blank" rel="external">express-etcd</a> An <a href="https://github.com/stianeikeland/node-etcd" target="_blank" rel="external">etcd</a> based session store.</p>
<p><img src="https://img.shields.io/github/stars/jackspaniel/hazelcast-store.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/hazelcast-store" target="_blank" rel="external">hazelcast-store</a> A Hazelcast-based session store built on the <a href="https://www.npmjs.com/package/hazelcast-client" target="_blank" rel="external">Hazelcast Node Client</a>.</p>
<p><img src="https://img.shields.io/github/stars/scriptollc/level-session-store.svg?label=%E2%98%85" alt="">[level-session-store] A <a href="https://www.npmjs.com/package/level-session-store" target="_blank" rel="external">LevelDB</a>-based session store.</p>
<p><img src="https://img.shields.io/github/stars/BenjaminVadant/medea-session-store.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/medea-session-store" target="_blank" rel="external">medea-session-store</a> A Medea-based session store.</p>
<p><img src="https://img.shields.io/github/stars/jwathen/mssql-session-store.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/mssql-session-store" target="_blank" rel="external">mssql-session-store</a> A SQL Server-based session store.</p>
<p><img src="https://img.shields.io/github/stars/JamesMGreene/nedb-session-store.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/nedb-session-store" target="_blank" rel="external">nedb-session-store</a> An alternate NeDB-based (either in-memory or file-persisted) session store.</p>
<p><img src="https://img.shields.io/github/stars/MattMcFarland/sequelstore-connect.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/sequelstore-connect" target="_blank" rel="external">sequelstore-connect</a> A session store using <a href="http://docs.sequelizejs.com/en/v3/" target="_blank" rel="external">Sequelize.js</a>.</p>
<p><img src="https://img.shields.io/github/stars/valery-barysok/session-file-store.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/session-file-store" target="_blank" rel="external">session-file-store</a>A file system-based session store.</p>
<p><img src="https://img.shields.io/github/stars/llambda/session-rethinkdb.svg?label=%E2%98%85" alt=""><a href="https://www.npmjs.com/package/session-rethinkdb" target="_blank" rel="external">session-rethinkdb</a>* A <a href="https://rethinkdb.com/" target="_blank" rel="external">RethinkDB</a>-based session store.</p>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>A simple example using express-session to store page views for a user.</p>
<h4 id="express框架之session-内存存储"><a href="#express框架之session-内存存储" class="headerlink" title="express框架之session 内存存储"></a>express框架之session 内存存储</h4><pre><code>1 var express = require(&apos;express&apos;);
 2 var session = require(&apos;express-session&apos;);
 3 var cookieParser = require(&apos;cookie-parser&apos;);
 4 
 5 var app = express();
 6 
7 app.use(cookieParser());
 8 app.use(session({
 9     secret: &apos;12345&apos;,
10     name: &apos;testapp&apos;,   //这里的name值得是cookie的name，默认cookie的name是：connect.sid
11     cookie: {maxAge: 80000 },  //设置maxAge是80000ms，即80s后session和相应的cookie失效过期
12     resave: false,
13     saveUninitialized: true,
14 }));
15 
16 
17 app.get(&apos;/awesome&apos;, function(req, res){
18     
19     if(req.session.lastPage) {
20         console.log(&apos;Last page was: &apos; + req.session.lastPage + &quot;.&quot;);    
21     }    
22     req.session.lastPage = &apos;/awesome&apos;; //每一次访问时，session对象的lastPage会自动的保存或更新内存中的session中去。
23     res.send(&quot;You&apos;re Awesome. And the session expired time is: &quot; + req.session.cookie.maxAge);
24 });
25 
26 app.get(&apos;/radical&apos;, function(req, res){
27     if (req.session.lastPage) {
28         console.log(&apos;Last page was: &apos; + req.session.lastPage + &quot;.&quot;);    
29     }
30     req.session.lastPage = &apos;/radical&apos;;  
31     res.send(&apos;What a radical visit! And the session expired time is: &apos; + req.session.cookie.maxAge);
32 });
33 
34 app.get(&apos;/tubular&apos;, function(req, res){
35     if (req.session.lastPage){
36         console.log(&quot;Last page was: &quot; + req.session.lastPage + &quot;.&quot;);    
37     }
    38 
39     req.session.lastPage = &apos;/tubular&apos;;
40     res.send(&apos;Are you a suffer? And the session expired time is: &apos; + req.session.cookie.maxAge);
41 });
42 
43 
44 app.listen(5000);
</code></pre><h4 id="express框架之session-数据库存储"><a href="#express框架之session-数据库存储" class="headerlink" title="express框架之session 数据库存储"></a>express框架之session 数据库存储</h4><p>　有时候，我们需要session的声明周期要长一点，比如好多网站有个免密码两周内自动登录的功能。基于这个需求，session必须寻找内存之外的存储载体，数据库能提供完美的解决方案。这里，我选用的是mongodb数据库，作为一个NoSQL数据库，它的基础数据对象时database-collection-document 对象模型非常直观并易于理解，针对node.js 也提供了丰富的驱动和API。express框架提供了针对mongodb的中间件：connect-mongo，我们只需在挂载session的时候在options中传入mongodb的参数即可，程序运行的时候, express app 会自动的替我们管理session的存储，更新和删除。具体可以参考：<br><a href="https://github.com/kcbanner/connect-mongo" target="_blank" rel="external">https://github.com/kcbanner/connect-mongo</a></p>
<pre><code> 1 var express = require(&apos;express&apos;);
 2 var session = require(&apos;express-session&apos;);
 3 var cookieParser = require(&apos;cookie-parser&apos;);
     4 var MongoStore = require(&apos;connect-mongo&apos;)(session);
 5 var app = express();
 6 
     7 app.use(cookieParser());
 8 app.use(session({
 9     secret: &apos;12345&apos;,
10     name: &apos;testapp&apos;,
11     cookie: {maxAge: 80000 },
12     resave: false,
13     saveUninitialized: true,
14     store: new MongoStore({   //创建新的mongodb数据库
15         host: &apos;localhost&apos;,    //数据库的地址，本机的话就是127.0.0.1，也可以是网络主机
16         port: 27017,          //数据库的端口号
17         db: &apos;test-app&apos;        //数据库的名称。
18     })
    19 }));
20 
21 
    22 app.get(&apos;/awesome&apos;, function(req, res){
23     
24     if(req.session.lastPage) {
25         console.log(&apos;Last page was: &apos; + req.session.lastPage + &quot;.&quot;);    
26     }    
27     req.session.lastPage = &apos;/awesome&apos;;
28     res.send(&quot;You&apos;re Awesome. And the session expired time is: &quot; + req.session.cookie.maxAge);
29 });
30 
31 app.get(&apos;/radical&apos;, function(req, res){
32     if (req.session.lastPage) {
33         console.log(&apos;Last page was: &apos; + req.session.lastPage + &quot;.&quot;);    
34     }
35     req.session.lastPage = &apos;/radical&apos;;
36     res.send(&apos;What a radical visit! And the session expired time is: &apos; + req.session.cookie.maxAge);
37 });
38 
39 app.get(&apos;/tubular&apos;, function(req, res){
40     if (req.session.lastPage){
41         console.log(&quot;Last page was: &quot; + req.session.lastPage + &quot;.&quot;);    
42     }
43 
44     req.session.lastPage = &apos;/tubular&apos;;
45     res.send(&apos;Are you a suffer? And the session expired time is: &apos; + req.session.cookie.maxAge);
46 });
47 
48 
49 app.listen(5000);
</code></pre><h4 id="session的生命周期："><a href="#session的生命周期：" class="headerlink" title="session的生命周期："></a>session的生命周期：</h4><p>　　由于session是存在服务器端数据库的，所以的它的生命周期可以持久化，而不仅限于浏览器关闭的时间。具体是由cookie.maxAge 决定：如果maxAge设定是1个小时，那么从这个因浏览器访问服务器导致session创建开始后，session会一直保存在服务器端，即使浏览器关闭，session也会继续存在。如果此时服务器宕机，只要开机后数据库没发生不可逆转的破坏，maxAge时间没过期，那么session是可以继续保持的。</p>
<p>　　当maxAge时间过期后，session会自动的数据库中移除，对应的还有浏览器的cookie。不过，由于connect-mongo的特殊机制（每1分钟检查一次过期session），session的移除可能在时间上会有一定的滞后。<br>部分参考：<a href="https://www.npmjs.com/package/express-session#cookiemaxage" target="_blank" rel="external">https://www.npmjs.com/package/express-session#cookiemaxage</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/10/05/expressSession/" class="archive-article-date">
  	<time datetime="2016-10-05T03:52:24.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-10-05</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2016/10/05/react/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          react
        
      </div>
    </a>
  
  
    <a href="/2016/09/22/javascript一/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">javascript一</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>




<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
	    <a class="jiathis_button_twitter"></a>
	    <a class="jiathis_button_plus"></a> 
	    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="expressSession" data-title="expressSession" data-url="http://yoursite.com/2016/10/05/expressSession/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>





      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 lgp
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接1</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接2</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接3</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接4</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接5</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接6</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>